      SUBROUTINE FINDAG(I,ISPC,D1,D2,H,SITAGE,SITHT,AGMAX1,HTMAX1,
     &                  HTMAX2,DEBUG)
      IMPLICIT NONE
C----------
C  **FINDAG--EC  DATE OF LAST REVISION:  01/12/11
C----------
C  THIS ROUTINE FINDS EFFECTIVE TREE AGE BASED ON INPUT VARIABLE(S)
C  CALLED FROM **COMCUP
C  CALLED FROM **CRATET
C  CALLED FROM **HTGF
C
C  SITAGE  --  LOADED WITH EFECTIVE AGE BASED ON CURRENT H
C  SITHT   --  LOADED WITH POTENTIAL HEIGHT CORRESPONDING TO
C              AGE IN SITAGE ARRAY
C----------
C  COMMONS
C
      INCLUDE 'PRGPRM.F77'
C
C
      INCLUDE 'CONTRL.F77'
C
C
      INCLUDE 'ARRAYS.F77'
C
C
      INCLUDE 'PLOT.F77'
C----------
C  DECLARATIONS
C----------
      LOGICAL DEBUG
      INTEGER I,ISPC
      REAL AGMAX(MAXSP),AHMAX(MAXSP),BHMAX(MAXSP),AGMAX1,HTMAX1,HTMAX2
      REAL AG,DIFF,H,HGUESS,HMAX,SINDX,TOLER,SITAGE,SITHT,D1,D2
C----------
C  DATA STATEMENTS
C----------
      DATA AGMAX/ 200., 110., 180., 130., 250., 130.,
     &            140., 150., 150., 200., 180./
      DATA AHMAX/
     & 2.3,12.86,-2.86,21.29,52.27,21.29,2.3,20.,45.27,-5.00 ,-2.06/
      DATA BHMAX/
     & 2.39,1.32,1.54,1.24,1.14,1.24,1.75,1.1,1.24,1.30,1.54/
C----------
C  INITIALIZATIONS
C----------
      TOLER=2.0
      SINDX = SITEAR(ISPC)
      AGMAX1 = AGMAX(ISPC)
      HTMAX1 = AHMAX(ISPC) + BHMAX(ISPC)*SINDX
      IF(ISPC .EQ. 11) HTMAX1 = AHMAX(ISPC) + BHMAX(ISPC)*SINDX*3.281
      AG=0.0
C----------
C THE FOLLOWING 5 LINES ARE AN RJ FIX 7-28-88
C----------
        IF(AG .LE. 0.0) THEN
          AG = 0.5
          IF(ISPC .EQ. 10) AG=(98.38*EXP(SINDX*(-0.0422)))+1.0
          IF(AG .LT. 0.5)AG = 0.5
          IF(ISPC .EQ. 3)AG=18.0
        ENDIF
        AG = 0.5
C----------
C THE FOLLOWING LINES ARE AN RJ FIX 7-28-88
C----------
        IF(ISPC .EQ. 10) AG=(98.38*EXP(SINDX*(-0.0422)))+1.0
        IF(AG .LT. 0.5)AG = 0.5
        IF(ISPC .EQ. 3)AG=18.0
C----------
C  CRATET CALLS FINDAG AT THE BEGINING OF THE SIMULATION TO
C  CALCULATE THE AGE OF INCOMING TREES.  AT THIS POINT ABIRTH(I)=0.
C  THE AGE OF INCOMING TREES HAVING H>=HMAX IS CALCULATED BY
C  ASSUMEING A GROWTH RATE OF 0.10FT/YEAR FOR THE INTERVAL H-HMAX.
C  TREES REACHING HMAX DURING THE SIMULATION ARE IDENTIFIED IN HTGF.
C----------
      IF(H .GE. HTMAX1) THEN
        SITAGE = AGMAX1 + (H - HTMAX1)/0.10
        SITHT = H
        IF(DEBUG)WRITE(JOSTND,*)' ISPC,AGMAX1,H,HTMAX1= ',
     $  ISPC,AGMAX1,H,HTMAX1
        GO TO 30
      ENDIF
C
   75 CONTINUE
C----------
C  CALL HTCALC TO CALCULATE POTENTIAL HT GROWTH
C----------
      HGUESS = 0.
      IF(DEBUG)WRITE(JOSTND,*)' IN FINDAG, CALLING HTCALC'
      CALL HTCALC(SINDX,ISPC,AG,HGUESS,JOSTND,DEBUG)
C
      IF(DEBUG)WRITE(JOSTND,91200)I,ISPC,AG,HGUESS,H
91200 FORMAT(' FINDAG I,ISPC,AG,HGUESS,H ',2I5,3F10.2)
C
      DIFF=ABS(HGUESS-H)
      IF(DIFF .LE. TOLER .OR. H .LT. HGUESS)THEN
        SITAGE = AG
        SITHT = HGUESS
        GO TO 30
      END IF
      AG = AG + 2.
C
      IF(AG .GT. AGMAX1) THEN
C----------
C  H IS TOO GREAT AND MAX AGE IS EXCEEDED
C----------
        SITAGE = AGMAX1
        SITHT = H
        GO TO 30
      ELSE
        GO TO 75
      ENDIF
C
   30 CONTINUE
      IF(DEBUG)WRITE(JOSTND,50)I,SITAGE,SITHT,AGMAX1,HTMAX1
   50 FORMAT(' LEAVING SUBROUTINE FINDAG  I,SITAGE,SITHT,AGMAX1,',
     &'HTMAX1 = ',I5,4F10.3)
C
      RETURN
      END
C**END OF CODE SEGMENT